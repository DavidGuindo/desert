<div class="mx-2">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Servicios</h2>

    <div class="d-flex align-items-center gap-3">
      <!-- Busqueda -->
      <div class="d-flex">
        <input type="text" class="form-control" placeholder="Buscar servicios..." (keyup)="applyFilter($event)"/> 
      </div>

      <!-- Ordenar -->
      <button mat-button [matMenuTriggerFor]="sortMenu" class="btn btn-outline-secondary d-flex align-items-center gap-1">
        <mat-icon style="font-size: 20px; width: 20px; height: 20px;">sort</mat-icon>
        Ordenar por
      </button>
      <mat-menu #sortMenu="matMenu">
        <!-- Opci칩n 1: Ordenar por Cliente -->
        <button mat-menu-item (click)="sort('client')">
          <mat-icon>business</mat-icon>
          <span>Cliente (A-Z)</span>
        </button>
        
        <!-- Opci칩n 2: Ordenar por urgente -->
        <button mat-menu-item (click)="sort('urgent')">
          <mat-icon>priority_high</mat-icon>
          <span>urgent</span>
        </button>
      </mat-menu>
      
      <!-- A침adir servicio -->
      <button class="btn btn-primary d-flex align-items-center gap-2">
        <mat-icon>add</mat-icon>
        A침adir servicio
      </button>
    </div>
  </div>

  <div class="row g-3">
    @for (service of paginatedServices; track $index) {
      <div class="col-sm-6 col-lg-4 col-xl-3" >
        <mat-card class="h-100 shadow-sm" (click)="openModalService(service)">
          <mat-card-header>
            <mat-card-title>{{ service.id }}</mat-card-title>
            <mat-card-subtitle class="text-truncate">{{ service.client }}</mat-card-subtitle>
            <button mat-icon-button class="ms-auto" [matMenuTriggerFor]="serviceMenu" (click)="$event.stopPropagation()">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #serviceMenu="matMenu">
              <button mat-menu-item (click)="openDeleteConfirmDialog(service.id)">
                <mat-icon>delete</mat-icon>
                <span>Eliminar</span>
              </button>
            </mat-menu>
          </mat-card-header>

          <mat-card-content>
            <div class="mb-2 d-flex align-items-center gap-2">
              <span class="badge" [ngClass]="getColorClassForState(service.state)">
                {{ getNameState(service.state) }}
              </span>
            </div>

            <mat-checkbox color="primary" [(ngModel)]="service.urgent" (click)="$event.stopPropagation()"> Urgente </mat-checkbox>

            <div class="mt-3">
              <div class="d-flex justify-content-between">
                <small class="text-secondary">Ensayos Completados</small>
                <small class="text-secondary">
                  <!-- {{ service.completedTasks }}/{{ service.totalTasks }} -->
                  {{ 5 }}/{{ 8 }}
                </small>
              </div>
              <mat-progress-bar [value]="(5/8)*100" color="primary"></mat-progress-bar>
              <!-- <mat-progress-bar [value]="getProgress(service)" color="primary"></mat-progress-bar> -->
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    }
  </div>


  <!-- Paginacion -->
  <mat-paginator   [length]="filteredServices.length"  
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[8, 12, 16]"
    showFirstLastButtons
    (page)="handlePageEvent($event)">
  </mat-paginator>
</div>

<app-alert #alert></app-alert>

